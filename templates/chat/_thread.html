<section id="thread-panel" class="thread-panel" x-data="chatThread()" x-init="init()">
  {% if conversation %}
  <header class="thread-head">
    <h2><span class="label-with-icon">{% include "chat/_icons/message.svg" %}{{ conversation.title }}</span></h2>
    <time class="thread-time" datetime="{{ conversation.updated_at }}">
      <span class="label-with-icon">{% include "chat/_icons/clock.svg" %}Updated {{ conversation.updated_at | fmt_ts }}</span>
    </time>
  </header>

  <div class="thread-body {% if config.DEBUG_SSE_STREAM %}thread-body--debug{% endif %}">
    <div class="thread-main">
      <div id="messages" class="messages" x-ref="messages">
        {% for message in messages %}
          {% include "chat/_message.html" %}
        {% endfor %}
      </div>

      <form
        id="composer-form"
        class="composer"
        hx-post="{{ url_for('web.post_message', conversation_id=conversation.id) }}"
        hx-target="#messages"
        hx-swap="beforeend transition:true"
      >
        <textarea
          id="composer-input"
          name="message"
          rows="3"
          required
          placeholder="Ask anything..."
          :disabled="pending"
        ></textarea>
        <div class="composer-actions">
          <button type="submit" :disabled="pending">
            <span class="label-with-icon">{% include "chat/_icons/send.svg" %}Send</span>
          </button>
        </div>
      </form>
    </div>

    {% if config.DEBUG_SSE_STREAM %}
    <aside class="debug-stream">
      <h3 class="debug-title"><span class="label-with-icon">{% include "chat/_icons/wrench.svg" %}Raw SSE Stream</span></h3>
      <div id="debug-events" class="debug-events"></div>
    </aside>
    {% endif %}
  </div>
  {% else %}
  <div class="empty-state">
    <p>No conversation selected.</p>
  </div>
  {% endif %}
</section>
